"use strict";var RK={};!function(){function s(){class s{constructor(s){this.e=s,this.name="",this.x={},this.dx={},this.x0=0,this.dx0=0,this.k=[],this.f=0,this.fs=0,this.he=-1}connect(s,t,h){this.x=s,this.dx=t,void 0!==h&&(this.name=h)}calcDelta0(s){let t;return t=0===this.dx.val?this.e:Math.abs(this.e*s*this.dx.val)}calcInterval(s,t){let h=0,i=this.calcDelta0(s),e=Math.abs(this.f-this.fs);e<=0&&(e=Number.MIN_VALUE),h=i>=e?.2:.25;let a=t*s*Math.pow(Math.abs(i/e),h);return a===Number.POSITIVE_INFINITY?a=Number.MAX_VALUE:a===Number.NEGATIVE_INFINITY&&(a=-Number.MAX_VALUE),a}}return{Pointer:class{constructor(s){this.val=s}},Methods:Object.freeze({Euler:"euler",Midpoint:"midpoint",Classic4th:"classic4th",Felhberg45:"felhberg45",CashKarp:"cashkarp",Fehlberg78:"fehlberg78"}),ODE:s,ODESystem:class{constructor(){}odeSetup(s){throw new Error("The `odeSetup()` method must be overridden by children classes")}updateODEs(){throw new Error("The `updateDerivs()` method must be overridden by children classes")}},RK:class{constructor(t,h,i){this.minDh=i.minDh,this.maxDh=i.maxDh,this.epsilon=i.error,this.sf=i.safetyFactor,this.wasReset=!1,this.constantsInit(h),this.odes=[];for(let h=0;h<t;h++)this.odes[h]=new s(this.epsilon);this.dh=this.minDh,this.h=0}motion(s,t,h){let i=h-t;this.h=t;let e=0;if(this.embedded||(this.dh=this.minDh),i<=0)return t;do{e=Math.min(this.dh,i),this.init(this.h,e);for(let t=1;t<=this.stepTotal;t++)this.step(t),s.updateODEs(),this.kUpdate(t);this.calcOrderPS(),this.embedded?i=this.runAdaptiveTimeStepSizeLogic(s,i):(this.finish(),s.updateODEs(),i-=this.dh)}while(i>1e-15*this.dh);return h}updateConfigParams(s,t,h){this.minDh=s,this.maxDh=t,this.epsilon=h,this.odes.forEach(s=>{s.e=this.epsilon}),this.dh=this.minDh}init(s,t){this.h0=s,this.h=s,this.dh=t,this.stepNum=1;for(let s=0;s<this.odes.length;s++)this.odes[s].x0=this.odes[s].x.val,this.odes[s].dx0=this.odes[s].dx.val}step(s){this.stepNum=s;let t=this.stepNum-1;this.h=this.h0+this.c[t]*this.dh;for(let s=0;s<this.odes.length;s++){this.odes[s].x.val=0;for(let h=0;h<t;h++)this.odes[s].x.val+=this.a[t][h]*this.odes[s].k[h];this.odes[s].x.val=this.odes[s].x0+this.dh*this.odes[s].x.val}}kUpdate(s){let t=s-1;for(let s=0;s<this.odes.length;s++)this.odes[s].k[t]=this.odes[s].dx.val}calcOrderPS(){for(let s=0;s<this.odes.length;s++){this.odes[s].fs=0;for(let t=0;t<this.stepTotal;t++)this.odes[s].fs+=this.bs[t]*this.odes[s].k[t];this.odes[s].fs=this.odes[s].x0+this.dh*this.odes[s].fs}}calcOrderP(){for(let s=0;s<this.odes.length;s++){this.odes[s].f=0;for(let t=0;t<this.stepTotal;t++)this.odes[s].f+=this.b[t]*this.odes[s].k[t];this.odes[s].f=this.odes[s].x0+this.dh*this.odes[s].f}}runAdaptiveTimeStepSizeLogic(s,t){this.calcOrderP();let h=this.dh;return this.dh=this.calcMinHerr(),this.dh<h?(this.reset(),this.wasReset=!0,t):(this.finish(),s.updateODEs(),this.wasReset=!1,t-h)}calcMinHerr(){var s=[];for(let t=0;t<this.odes.length;t++)s[t]=this.odes[t].calcInterval(this.dh,this.sf),this.odes[t].he=s[t];let t=Math.min(...s);return t>this.maxDh?t=this.maxDh:t<this.minDh&&(t=this.minDh),t}finish(){for(let s=0;s<this.odes.length;s++)this.odes[s].x.val=this.odes[s].fs}reset(){this.h=this.h0;for(let s=0;s<this.odes.length;s++)this.odes[s].x.val=this.odes[s].x0,this.odes[s].dx.val=this.odes[s].dx0}constantsInit(s){this.a=[],this.b=[],this.bs=[],this.c=[];var t="constantsInit_"+s;if(void 0===this[t])throw new Error("Chosen rk method "+s+" is not supported");this[t]()}constantsInit_euler(){this.stepTotal=1,this.embedded=!1,this.a[0]=[],this.a[0][0]=0,this.b[0]=0,this.bs[0]=1,this.c[0]=0}constantsInit_midpoint(){this.stepTotal=2,this.embedded=!1;for(let s=0;s<this.stepTotal;s++){this.a[s]=[],this.b[s]=0,this.bs[s]=0,this.c[s]=0;for(let t=0;t<this.stepTotal;t++)this.a[s][t]=0}this.a[1][0]=.5,this.b[0]=0,this.bs[0]=0,this.bs[1]=1,this.c[0]=0,this.c[1]=.5}constantsInit_classic4th(){this.stepTotal=4,this.embedded=!1;for(let s=0;s<this.stepTotal;s++){this.a[s]=[],this.b[s]=0,this.bs[s]=0,this.c[s]=0;for(let t=0;t<this.stepTotal;t++)this.a[s][t]=0}this.a[1][0]=.5,this.a[2][1]=.5,this.a[3][2]=1,this.b[0]=0,this.bs[0]=1/6,this.bs[1]=1/3,this.bs[2]=1/3,this.bs[3]=1/6,this.c[0]=0,this.c[1]=.5,this.c[2]=.5,this.c[3]=1}constantsInit_cashkarp(){this.stepTotal=6,this.embedded=!0;for(let s=0;s<this.stepTotal;s++){this.a[s]=[],this.b[s]=0,this.bs[s]=0,this.c[s]=0;for(let t=0;t<this.stepTotal;t++)this.a[s][t]=0}this.a[1][0]=.2,this.a[2][0]=.075,this.a[3][0]=.3,this.a[4][0]=-11/54,this.a[5][0]=1631/55296,this.a[2][1]=.225,this.a[3][1]=-.9,this.a[4][1]=2.5,this.a[5][1]=175/512,this.a[3][2]=1.2,this.a[4][2]=-70/27,this.a[5][2]=575/13824,this.a[4][3]=35/27,this.a[5][3]=44275/110592,this.a[5][4]=253/4096,this.b[0]=37/378,this.b[1]=0,this.b[2]=250/621,this.b[3]=125/594,this.b[4]=0,this.b[5]=512/1771,this.bs[0]=2825/27648,this.bs[1]=0,this.bs[2]=18575/48384,this.bs[3]=13525/55296,this.bs[4]=277/14336,this.bs[5]=.25,this.c[0]=0,this.c[1]=.2,this.c[2]=.3,this.c[3]=.6,this.c[4]=1,this.c[5]=7/8}constantsInit_fehlberg45(){this.stepTotal=6,this.embedded=!0;for(let s=0;s<this.stepTotal;s++){this.a[s]=[],this.b[s]=0,this.bs[s]=0,this.c[s]=0;for(let t=0;t<this.stepTotal;t++)this.a[s][t]=0}this.a[1][0]=.25,this.a[2][0]=3/32,this.a[3][0]=1932/2197,this.a[4][0]=439/216,this.a[5][0]=-8/27,this.a[2][1]=9/32,this.a[3][1]=-7200/2197,this.a[4][1]=-8,this.a[5][1]=2,this.a[3][2]=7296/2197,this.a[4][2]=-3680/513,this.a[5][2]=-3544/2565,this.a[4][3]=-845/4104,this.a[5][3]=1859/4104,this.a[5][4]=-.275,this.b[0]=16/135,this.b[1]=0,this.b[2]=6656/12825,this.b[3]=28561/56430,this.b[4]=-.18,this.b[5]=2/55,this.bs[0]=25/216,this.bs[1]=0,this.bs[2]=1408/2565,this.bs[3]=2197/4104,this.bs[4]=-.2,this.bs[5]=0,this.c[0]=0,this.c[1]=.25,this.c[2]=3/8,this.c[3]=12/13,this.c[4]=1,this.c[5]=.5}constantsInit_fehlberg78(){this.stepTotal=13,this.embedded=!0;for(let s=0;s<this.stepTotal;s++){this.a[s]=[],this.b[s]=0,this.bs[s]=0,this.c[s]=0;for(let t=0;t<this.stepTotal;t++)this.a[s][t]=0}this.a[1][0]=2/27,this.a[2][0]=1/36,this.a[3][0]=1/24,this.a[4][0]=5/12,this.a[5][0]=.05,this.a[6][0]=-25/108,this.a[7][0]=31/300,this.a[8][0]=2,this.a[9][0]=-91/108,this.a[10][0]=2383/4100,this.a[11][0]=3/205,this.a[12][0]=-1777/4100,this.a[2][1]=1/12,this.a[3][2]=1/8,this.a[4][2]=-25/16,this.a[4][3]=25/16,this.a[5][3]=.25,this.a[6][3]=125/108,this.a[7][3]=0,this.a[8][3]=-53/6,this.a[9][3]=23/108,this.a[10][3]=-341/164,this.a[11][3]=0,this.a[12][3]=-341/164,this.a[5][4]=.2,this.a[6][4]=-65/27,this.a[7][4]=61/225,this.a[8][4]=704/45,this.a[9][4]=-976/135,this.a[10][4]=4496/1025,this.a[11][4]=0,this.a[12][4]=4496/1025,this.a[6][5]=125/54,this.a[7][5]=-2/9,this.a[8][5]=-107/9,this.a[9][5]=311/54,this.a[10][5]=-301/82,this.a[11][5]=-6/41,this.a[12][5]=289/82,this.a[7][6]=13/900,this.a[8][6]=67/90,this.a[9][6]=-19/60,this.a[10][6]=2133/4100,this.a[11][6]=-3/205,this.a[12][6]=2193/4100,this.a[8][7]=3,this.a[9][7]=17/6,this.a[10][7]=45/82,this.a[11][7]=-3/41,this.a[12][7]=51/82,this.a[9][8]=-1/12,this.a[10][8]=45/164,this.a[11][8]=3/41,this.a[12][8]=33/164,this.a[10][9]=18/41,this.a[11][9]=6/41,this.a[12][9]=12/41,this.a[12][11]=1,this.b[0]=41/840,this.b[1]=0,this.b[2]=0,this.b[3]=0,this.b[4]=0,this.b[5]=34/105,this.b[6]=9/35,this.b[7]=9/35,this.b[8]=9/280,this.b[9]=9/280,this.b[10]=41/840,this.b[11]=0,this.b[12]=0,this.bs[0]=0,this.bs[1]=0,this.bs[2]=0,this.bs[3]=0,this.bs[4]=0,this.bs[5]=34/105,this.bs[6]=9/35,this.bs[7]=9/35,this.bs[8]=9/280,this.bs[9]=9/280,this.bs[10]=0,this.bs[11]=41/840,this.bs[12]=41/840,this.c[0]=0,this.c[1]=2/27,this.c[2]=1/9,this.c[3]=1/6,this.c[4]=5/12,this.c[5]=.5,this.c[6]=5/6,this.c[7]=1/6,this.c[8]=2/3,this.c[9]=1/3,this.c[10]=1,this.c[11]=0,this.c[12]=1}}}}"undefined"!=typeof module?module.exports=s():RK=s()}();
